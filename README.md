# Self-Hosted Infracost API

This terraform module can be used to setup quickly a self-hosted infracost API.   
To get more info about it, check https://www.infracost.io/docs/cloud_pricing_api/self_hosted/.


## Before start
First get your API_TOKEN from `infracost register`.   
To get more information, check https://www.infracost.io/docs/features/cli_commands/.

## Usage
```hcl
module "infracost_instance" {
    source = "git@github.com:edsoncelio/tf-infracost-self-hosted.git"

    ... ommited

}
```
The endpoint will take something like 7-8 minutes to be available.

To configure the infracost via CLI:
```shell
infracost configure set pricing_api_endpoint <the endpoint from output>
infracost configure set api_key <the key from output >

infracost breakdown --path /path/to/code
```

## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.0 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 4.0 |
| <a name="requirement_http"></a> [http](#requirement\_http) | >= 2.0 |
| <a name="requirement_random"></a> [random](#requirement\_random) | >= 3.0 |
| <a name="requirement_template"></a> [template](#requirement\_template) | >= 2.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | >= 4.0 |
| <a name="provider_http"></a> [http](#provider\_http) | >= 2.0 |
| <a name="provider_random"></a> [random](#provider\_random) | >= 3.0 |
| <a name="provider_template"></a> [template](#provider\_template) | >= 2.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_ec2_instance"></a> [ec2\_instance](#module\_ec2\_instance) | terraform-aws-modules/ec2-instance/aws | ~> 3.0 |
| <a name="module_sg_endpoint"></a> [sg\_endpoint](#module\_sg\_endpoint) | terraform-aws-modules/security-group/aws | ~> 4.0 |
| <a name="module_sg_ssh"></a> [sg\_ssh](#module\_sg\_ssh) | terraform-aws-modules/security-group/aws | ~> 4.0 |

## Resources

| Name | Type |
|------|------|
| [random_password.password](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/password) | resource |
| [aws_ami.ubuntu](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ami) | data source |
| [aws_subnets.selected](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/subnets) | data source |
| [http_http.myip](https://registry.terraform.io/providers/hashicorp/http/latest/docs/data-sources/http) | data source |
| [template_file.user_data](https://registry.terraform.io/providers/hashicorp/template/latest/docs/data-sources/file) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_ami_id"></a> [ami\_id](#input\_ami\_id) | AMI ID (If not, used Ubuntu 20.x) | `string` | `null` | no |
| <a name="input_infracost_api_key"></a> [infracost\_api\_key](#input\_infracost\_api\_key) | Infracost API Key generated by infracost register | `string` | n/a | yes |
| <a name="input_instance_type"></a> [instance\_type](#input\_instance\_type) | Instance size | `string` | `"t2.medium"` | no |
| <a name="input_key_name"></a> [key\_name](#input\_key\_name) | SSH key name | `string` | `null` | no |
| <a name="input_subnet_id"></a> [subnet\_id](#input\_subnet\_id) | Subnet ID to create the resources (If not, use the first one) | `string` | `null` | no |
| <a name="input_vpc_id"></a> [vpc\_id](#input\_vpc\_id) | VPC Id to create the resources | `string` | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_infracost_endpoint"></a> [infracost\_endpoint](#output\_infracost\_endpoint) | URL to infracost endpoint |
| <a name="output_self_hosted_infracost_key"></a> [self\_hosted\_infracost\_key](#output\_self\_hosted\_infracost\_key) | self hosted api key |
